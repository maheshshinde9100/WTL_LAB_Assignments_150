<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student CRUD Application</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f7fa; }
    header { text-align: center; margin-bottom: 20px; }
    .buttons { display: flex; gap: 10px; margin-top: 15px; }
    button { padding: 10px 15px; cursor: pointer; }
    .response { margin-top: 20px; background: #eee; padding: 10px; border-radius: 5px; }
    .student-table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    .student-table th, .student-table td { border: 1px solid #ccc; padding: 8px; }
  </style>
</head>
<body onload="openHosted()">
  <header>
    <h1>Student CRUD Application</h1>
    <p>Manage student records</p>
  </header>

  <div>
    <label>Name: <input type="text" id="name"></label><br><br>
    <label>Marks: <input type="number" id="marks"></label><br>

    <div class="buttons">
      <button id="insert">Insert</button>
      <button id="update">Update</button>
      <button id="delete">Delete</button>
      <button id="get">Get One</button>
      <button id="getAll">Get All</button>
    </div>
  </div>

  <div class="response">
    <h3>API Response</h3>
    <pre id="apiResponse">// Response will appear here</pre>
  </div>

  <div id="studentData"></div>

  <script>
    function openHosted(){
        //opening deployed site
        window.location.href = "https://mahesh-shinde.page.gd/index.html";
    }
    document.addEventListener('DOMContentLoaded', function() {
      const nameInput = document.getElementById('name');
      const marksInput = document.getElementById('marks');
      const responseElement = document.getElementById('apiResponse');
      const studentDataElement = document.getElementById('studentData');

      async function makeRequest(url, method, data = null) {
        try {
          const options = { method, headers: { 'Content-Type': 'application/json' } };
          if (data) options.body = JSON.stringify(data);

          const response = await fetch(url, options);
          const text = await response.text(); // debug mode
          console.log("RAW RESPONSE:", text);

          let responseData;
          try { responseData = JSON.parse(text); }
          catch { throw new Error("Invalid JSON: " + text); }

          responseElement.textContent = JSON.stringify(responseData, null, 2);
          if (response.ok && method === 'GET') displayStudentData(responseData);
          return responseData;
        } catch (error) {
          responseElement.textContent = `Error: ${error.message}`;
          console.error('Error:', error);
        }
      }

      function displayStudentData(data) {
        if (!data || (Array.isArray(data) && data.length === 0)) {
          studentDataElement.innerHTML = '<p>No student data found.</p>';
          return;
        }
        const students = Array.isArray(data) ? data : [data];
        let tableHTML = `<table class="student-table"><tr><th>Name</th><th>Marks</th></tr>`;
        students.forEach(s => {
          tableHTML += `<tr><td>${s.name}</td><td>${s.marks}</td></tr>`;
        });
        tableHTML += `</table>`;
        studentDataElement.innerHTML = tableHTML;
      }

      document.getElementById('insert').onclick = () => {
        makeRequest("insert.php", "POST", { name: nameInput.value, marks: parseInt(marksInput.value) });
      };
      document.getElementById('update').onclick = () => {
        makeRequest("update.php", "PUT", { name: nameInput.value, marks: parseInt(marksInput.value) });
      };
      document.getElementById('delete').onclick = () => {
        makeRequest("delete.php", "DELETE", { name: nameInput.value });
      };
      document.getElementById('get').onclick = () => {
        makeRequest(`read.php?name=${encodeURIComponent(nameInput.value)}`, "GET");
      };
      document.getElementById('getAll').onclick = () => {
        makeRequest("read.php", "GET");
      };
    });
  </script>
</body>
</html>
